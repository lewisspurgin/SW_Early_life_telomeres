---
output:
  word_document:
    reference_docx: myref.docx
---
```{r setup, include = F}

rm(list=ls())

#Load knitr
library(knitr)

#Set some options
options(na.action='na.fail')
opts_knit$set(root.dir = '..')
opts_chunk$set(include=FALSE,
               message=FALSE,
               fig.show='hide')

```

```{r load and clean, include = F}


#Load and clean data
source('Scripts/SW juvenile telomeres IPC load.r')
source('Scripts/SW juvenile telomeres IPC functions.r')
source('Scripts/SW juvenile telomeres IPC clean.r')


```


**Table1**
```{r Table 1}
temp <- subset(dd,!is.na(Insect))


#Run the model
lm2 <- lmer(RTL ~  LogAge + Tarsus + Helper + GroupSize + Sex + BodyMass + Insect + Density + (1|LayYear) + (1|BirdID) + (1|PlateID),
            data = temp,
            REML = FALSE)
CIs <- confint.merMod(lm2)
t1 <- data.frame(Estimate = fixef(lm2), s.e. = se.fixef(lm2), LCI = CIs[5:nrow(CIs),1], UCI = CIs[5:nrow(CIs),2])
kable(t1)

```


**Figure Legends**

**Figure 1** RTL in relation to **(A)** age and **(B)** $\Delta$Age in Seychelles warblers. Lines and shaded areas are fitted values and 95% confidence limits from linear regressions.

**Figure 2** Cohort effects on early-life RTL in Seychelles warblers. **A** temporal variation RTL in major and minor cohorts, **B** temporal variation in adult population size, and **C** early-life RTL in relation to cohort-level variation in adult population size. Lines and shaded areas in **C** are fitted values and 95% confidence limits from general linear models.

**Figure 3** Factors affecting early-life RTL in Seychelles warblers. **A** Model averaged estimates and 95% confidence intervals for explanatory terms used in a linear mixed model with RTL as the response variable (see main text for details; TQ = territory quality). **B,C** Early-life RTL and age in relation to tarsus length (**B**) and sex (**C**). Lines and shaded areas in **B** are fitted values and 95% confidence limits from a general linear model.

**Figure 4** Longitudinal telomere dynamics in juvenile Seychelles warblers. **A** juvenile telomere length in relation to adult telomere length measured in the same individual. **B** $\Delta$RTL in relation to the time between sampling events. Lines and shaded areas represent fitted values and 95% confidence limits from general linear models. Raw data have been ommited from **B** for the sake of clarity, but are plotted in Figure S1.

**Figure 5** Factors affecting $\Delta$RTL in juvenile Seychelles warblers. **A** Model averaged estimates and 95% confidence intervals for explanatory terms used in a linear mixed model with $\Delta$RTL as the response variable (see main text for details; TQ = territory quality). **B** $\Delta$RTL in relation to tarsus length and sex.




```{r Figure 1}

Fig1A <- subset(dd,Age<15) %>%
  ddply(.(BirdID),
        mutate,
        nreps = length(RTL)) %>%
  subset(nreps>0) %>%
  subset(!duplicated(paste0(BirdID,Agemonths))) %>%
  ggplot(aes(x = Agemonths,y = RTL,group = BirdID,col=factor(BirdID)))+
  geom_point(alpha = 1,col='grey')+
geom_line(col = 'darkgrey',alpha = 0.2)+
  xlab('Age (years)') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        axis.line.x = element_line(colour = 'black'),
        axis.line.y = element_line(colour = 'black'),
        legend.position = 'none')+
  geom_smooth(col = 'black',fill = 'black',lwd = 0.5,aes(group = NULL),method = 'lm',formula = y~log(x))
  annotate('text',x = 0,y = 3,label = 'A')


Fig1B <- ggplot(dd3,
       aes(x = RTL,
           y = RTL1)) +
  ylab(expression('RTL ('*italic(t)*' + 1)')) + 
  xlab(expression('RTL ('*italic(t)*')')) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        legend.position = c('none'),
        legend.title = element_text(size = 12),
        axis.line.x = element_line(colour = 'black'),
        axis.line.y = element_line(colour = 'black')) +
    geom_point(col = 'grey')+
  geom_abline(slope = 1,intercept = 0,lty = 2)
  annotate('text',x = 0,y = 3,label = 'B')



Fig1C <- ggplot(ddL,aes(col=Group,fill = Group,y = ..scaled..,x = DeltaRTL))+
    geom_density(alpha = 0.2)+
  theme_classic()+
  ylab ('Scaled density')+
  xlab(expression(Delta*'RTL'))+
    theme(axis.text.x = element_text(size = 12), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        legend.position = 'none',
        legend.title = element_blank(),
        axis.line.x = element_line(colour = 'black'),
        axis.line.y = element_line(colour = 'black')) +
  scale_colour_manual(values = c('darkgrey','gold'))+
  scale_fill_manual(values = c('darkgrey','gold'))+
  geom_vline(xintercept = 0,lty = 2)
  annotate('text',x = -2,y = 1,label = 'C')



pdf('Figures/Figure 1.pdf',
    width = 8,
    height = 8,
    paper = 'a4')
multiplot(Fig1A,Fig1B,Fig1C,layout=matrix(c(1,1,1,1,2,3),nrow=3,byrow=T))
dev.off()

```







```{r Figure 2}


Fig2A <- transform(juv,Cohort = factor(LayYear)) %>%
  subset(Agemonths>(1/12)) %>%
  ggplot(aes(y = RTL,x = Cohort))+
  xlab('Cohort') +
  geom_boxplot() +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,angle = 90), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        axis.line.x = element_line(colour = 'black'),
        axis.line.y = element_line(colour = 'black'))
  annotate('text',x = 0,y = 1.4,label = 'B')


Fig2B <- ddply(dd,
               .(Agemonths,LayYear),
               summarise,
               meanRTL = mean(RTL),
               n = length(RTL))  %>%
  ddply(.(LayYear),
        mutate,
        nAges = length(meanRTL),
        minAge = min(Agemonths)) %>%
  subset(LayYear %in% c(2001:2009)) %>%
  subset(n>4) %>%
  transform(Cohort = factor(LayYear)) %>%
  ggplot(aes(x = Agemonths,y = meanRTL,col = Cohort))+
  xlab('Age (years)') +
  ylab('Mean RTL') +
  geom_point()+
  geom_line()+
  theme_classic() +
  theme(axis.text.x = element_text(size = 12), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        axis.line.x = element_line(colour = 'black'),
        axis.line.y = element_line(colour = 'black'),
        legend.position = 'none')
  annotate('text',x = 0,y = 1.4,label = 'B')

pdf('Figures/Figure 2.pdf',
    width = 5,
    height = 8,
    paper = 'a4')
multiplot(Fig2A,Fig2B)
dev.off()


```



```{r Figure 3}

Fig3A <- ggplot(temp,
       aes(x = Tarsus,
           y = RTL,
           col = Sex)) +
  geom_point()+
  ylab('RTL') + 
  xlab('Tarsus length (mm)') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
                axis.line.x = element_line(colour = 'black'),
        axis.line.y = element_line(colour = 'black'),
        legend.position = 'none') +
  stat_smooth(method = 'lm')
  annotate('text',x = 17,y = 2.5,label = 'C')

Fig3B <- ggplot(temp,
       aes(
           y = RTL,
           x=Insect)) +
    ylab('RTL') + 
  xlab('Insect abundance') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
                axis.line.x = element_line(colour = 'black'),
        axis.line.y = element_line(colour = 'black'),
        legend.position = 'none') +
  geom_boxplot(aes(group = Insect),outlier.shape = NA)+
   stat_smooth(method = 'lm',col = 'darkgrey')
  annotate('text',x = 2.5,y = 2.5,label = 'D')


pdf('Figures/Figure 3.pdf',
    width = 5,
    height = 8,
    paper = 'a4')
multiplot(Fig3A,Fig3B)
dev.off()

```




