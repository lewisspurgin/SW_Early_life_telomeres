---
output:
  word_document:
    reference_docx: myref.docx
---
```{r setup, include = F}

rm(list=ls())

#Load knitr
library(knitr)

#Set some options
options(na.action='na.fail')
opts_knit$set(root.dir = '..')
opts_chunk$set(include=FALSE,
               message=FALSE,
               fig.show='hide')

```

```{r load and clean, include = F}


#Load and clean data
source('Scripts/SW juvenile telomeres IPC load.r')
source('Scripts/SW juvenile telomeres IPC functions.r')
source('Scripts/SW juvenile telomeres IPC clean.r')
source('Scripts/SW juvenile telomeres IPC models.r')

```

**Table 1**
```{r Table 1}

 
AIC(RTL_LogAge)
AIC(RTL_LogAge_LY)


```


**Table 2**
```{r Table 2}

 
CIs <- CIwald(RTL_Full)
t1 <- data.frame(Estimate = fixef(RTL_Full), LCI = CIs[7:nrow(CIs),1], UCI = CIs[7:nrow(CIs),2])

nams <- row.names(t1)
nams[nams == 'LogAge'] <- 'Age'
nams[nams == 'Tarsus'] <- 'Tarsus length'
nams[nams == 'Helper'] <- 'Number helpers'
nams[nams == 'GroupSize'] <- 'Group size'
nams[nams == 'SexMales'] <- 'Sex (males)'
nams[nams == 'BodyMass'] <- 'Body mass'
nams[nams == 'Insect'] <- 'Annual food availability'
nams[nams == 'TQ'] <- 'Territory quality'

row.names(t1) <- nams

kable(t1)

```

**Table 2**

```{r Table 2}

#Run the model
CIs <- CIwald(DeltaRTL_Full)
t1 <- data.frame(Estimate = fixef(DeltaRTL_Full), LCI = CIs[4:nrow(CIs),1], UCI = CIs[4:nrow(CIs),2])

nams <- row.names(t1)
nams[nams == 'LogAge'] <- 'Age'
nams[nams == 'Tarsus'] <- 'Tarsus length'
nams[nams == 'Helper'] <- 'Number helpers'
nams[nams == 'GroupSize'] <- 'Group size'
nams[nams == 'SexMales'] <- 'Sex (males)'
nams[nams == 'BodyMass'] <- 'Body mass'
nams[nams == 'Insect'] <- 'Annual food availability'
nams[nams == 'TQ'] <- 'Territory quality'

row.names(t1) <- nams

kable(t1)

```

**Figure Legends**

**Figure 1** Telomere length in relation to age in Seychelles warblers. Points and  thin grey lines represent individual samples and birds, respectively. The thick line and shaded area represent the fitted values and 95% confidence limits of a linea regression of RTL and log-transformed age.

**Figure 2** Longitudinal telomere dynamics in the Seychelles warbler. **A** Variation in RTL within individuals sampled at different time points. The dotted line represents parity, and thus points above and below the line represent increases and decreases in RTL, respectively. **B** Scaled density plots of repeated RTL measurements among individual samples, and among different samples taken from the same individual.

**Figure 3** Cohort variaiton in telomere length in the Seychelles warbler. **A** Bocplot of RTL among all Seychelles warbler cohorts. **B** Relationship between RTL and age in individual cohorts. Only cohorts with samples of at least 10 nestlings were included. Lines represent represents the fitted values from a linear regression of RTL and log-transformed age.

**Figure 4** Individual variation in telomere length in Seychelles warbler. **A** RTL in relation to tarsus length and sex. **B** RTL in relation to variation in annual food availability. Lines and shaded areas represent the fitted values and 95% confidence limits from linear regressions.

```{r Figure 1}

Fig1A <- ddply(dd,
               .(BirdID),
        mutate,
        nreps = length(RTL)) %>%
  subset(nreps>0) %>%
  subset(!duplicated(paste0(BirdID,Agemonths))) %>%
  ggplot(aes(x = Agemonths,y = RTL,group = BirdID,col=factor(BirdID)))+
  geom_point(alpha = 1,col='grey')+
geom_line(col = 'darkgrey',alpha = 0.2)+
  xlab('Age (years)') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        axis.line.x = element_line(colour = 'black'),
        axis.line.y = element_line(colour = 'black'),
        legend.position = 'none')+
  geom_smooth(col = 'black',fill = 'black',lwd = 0.5,aes(group = NULL),method = 'lm',formula = y~log(x))+
  annotate('text',x = 0,y = 1.7,label = 'A')


  Fig1B <- ggplot(dd3, aes(x = DeltaAge,y = RTL))+
  geom_point(alpha = 1,col='grey')+
  xlab(expression(Delta*'Age (years)')) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        axis.line.x = element_line(colour = 'black'),
        axis.line.y = element_line(colour = 'black'),
        legend.position = 'none')+
  geom_smooth(col = 'black',method = 'lm')+
  annotate('text',x = -7.5,y = 1.7,label = 'B')



pdf('Figures/Figure 1.pdf',
    width = 4,
    height = 8,
    paper = 'a4')
multiplot(Fig1A,Fig1B)
dev.off()

```



```{r Figure 2}
c15 <- c("dodgerblue2","#E31A1C", # red
                "green4",
                "#FF7F00", # orange
                "gold1",
                "skyblue2", # lt pink
                "palegreen2",
                "#FDBF6F", # lt orange
                "gray70", "khaki2","blue1","steelblue4",
                "darkturquoise",
                "darkorange4","brown")

Fig2A <- transform(dd,Cohort = factor(LayYear)) %>%
  subset(Cohort %in% c(2002:2011)) %>%
  ggplot(aes(y = RTL,x = Cohort,fill = Cohort))+
  xlab('Birth year') +
  geom_boxplot(notch=T) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,angle = 90), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        axis.line.x = element_line(colour = 'black'),
        axis.line.y = element_line(colour = 'black'),
        legend.position = 'none')+
  scale_fill_manual(values = c15)+
  annotate('text',x = 1,y = 1.7,label = 'A')


Fig2B <- transform(dd,Cohort = factor(LayYear)) %>%
  subset(Cohort %in% c(2002:2011)) %>%
  ggplot(aes(y = RTL,x = Agemonths, col = Cohort))+
  xlab('Age (years)') +
  geom_smooth(method = 'lm', formula = y~log(x),se = F) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        axis.line.x = element_line(colour = 'black'),
        axis.line.y = element_line(colour = 'black'),
        legend.position = 'none') +
    scale_color_manual(values = c15)+
  annotate('text',x = 0,y = 1.15,label = 'B')

Fig2C <- transform(dd,Cohort = factor(CatchYear)) %>%
  subset(Cohort %in% c(2002:2011)) %>%
  ggplot(aes(y = RTL,x = Cohort,fill = Cohort))+
  xlab('Sampling year') +
  geom_boxplot(notch=T) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,angle = 90), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        axis.line.x = element_line(colour = 'black'),
        axis.line.y = element_line(colour = 'black'),
        legend.position = 'none') + 
    scale_fill_manual(values = c15)+
  annotate('text',x = 1,y = 1.7,label = 'C')


Fig2D <- transform(dd,Cohort = factor(CatchYear)) %>%
  subset(Cohort %in% c(2002:2011)) %>%
  ggplot(aes(y = RTL,x = Agemonths, col = Cohort))+
  xlab('Age (years)') +
  geom_smooth(method = 'lm', formula = y~log(x),se = F) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        axis.line.x = element_line(colour = 'black'),
        axis.line.y = element_line(colour = 'black'),
        legend.position = 'none') +
    scale_color_manual(values = c15)+
  annotate('text',x = 0,y = 1.15,label = 'D')  
  
pdf('Figures/Figure 2.pdf',
    width = 8,
    height = 8,
    paper = 'a4')
multiplot(Fig2A,Fig2B,Fig2C,Fig2D,layout = matrix(1:4, 2, 2,byrow = T))
dev.off()


```








```{r Figure 2}

c15 <- c("dodgerblue2","#E31A1C", # red
                "green4",
                "#FF7F00", # orange
                "gold1",
                "skyblue2", # lt pink
                "palegreen2",
                "#FDBF6F", # lt orange
                "gray70", "khaki2","blue1","steelblue4",
                "darkturquoise",
                "darkorange4","brown")

Fig2A <- transform(dd,Cohort = factor(LayYear)) %>%
  subset(Cohort %in% c(2002:2011)) %>%
  ggplot(aes(y = RTL,x = Cohort,fill = Cohort))+
  xlab('Birth year') +
  geom_boxplot(notch=T,aes(outlier.colour = Cohort)) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12,angle = 90), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        axis.line.x = element_line(colour = 'black'),
        axis.line.y = element_line(colour = 'black'),
        legend.position = 'none')+
  scale_fill_manual(values = c15)+
  annotate('text',x = 1,y = 1.7,label = 'A')


Fig2B <- transform(dd3,Cohort = factor(LayYear)) %>%
  subset(Cohort %in% c(2002:2011)) %>%
  ggplot(aes(y = RTL,x = Agemonths, col = Cohort))+
  xlab('Age (years)') +
  geom_smooth(method = 'lm', formula = y~log(x),se = F) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        axis.line.x = element_line(colour = 'black'),
        axis.line.y = element_line(colour = 'black'),
        legend.position = 'none') +
    scale_color_manual(values = c15)+
  annotate('text',x = 0,y = 1.15,label = 'B')

pdf('Figures/Figure 2.pdf',
    width = 4,
    height = 8,
    paper = 'a4')
multiplot(Fig2A,Fig2B)
dev.off()


```









```{r Figure 3}

Fig3A <- ggplot(dd3,
       aes(x = RTL,
           y = RTL1)) +
  ylab(expression('RTL ('*italic(t)*' + 1)')) + 
  xlab(expression('RTL ('*italic(t)*')')) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        legend.position = c('none'),
        legend.title = element_text(size = 12),
        axis.line.x = element_line(colour = 'black'),
        axis.line.y = element_line(colour = 'black')) +
    geom_point(col = 'grey')+
  geom_abline(slope = 1,intercept = 0,lty = 2) +
  annotate('text',x = 0.3,y = 1.7,label = 'A')



Fig3B <- ggplot(ddL,aes(col=Group,fill = Group,y = ..scaled..,x = DeltaRTL))+
    geom_density(alpha = 0.2)+
  theme_classic()+
  ylab ('Scaled density')+
  xlab(expression(Delta*'RTL'))+
    theme(axis.text.x = element_text(size = 12), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        legend.position = 'none',
        legend.title = element_blank(),
        axis.line.x = element_line(colour = 'black'),
        axis.line.y = element_line(colour = 'black')) +
  scale_colour_manual(values = c('darkgrey','gold'))+
  scale_fill_manual(values = c('darkgrey','gold'))+
  geom_vline(xintercept = 0,lty = 2) +
  annotate('text',x = -1,y = 1,label = 'B')

pdf('Figures/Figure 3.pdf',
    width = 4,
    height = 8,
    paper = 'a4')
multiplot(Fig3A,Fig3B)
dev.off()

  
```



```{r Figure 4}

Fig4A <- ggplot(dd,
       aes(x = Tarsus,
           y = RTL,
           col = Sex)) +
  geom_point()+
  ylab('RTL') + 
  xlab('Tarsus length (mm)') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
                axis.line.x = element_line(colour = 'black'),
        axis.line.y = element_line(colour = 'black'),
        legend.position = 'none') +
  stat_smooth(method = 'lm') +
  scale_color_manual(values = c('gold2','red'))+
  annotate('text',x = 17,y = 1.7,label = 'A')

Fig4B <- ggplot(dd,
       aes(y = RTL,
           x=Insect)) +
    ylab('RTL') + 
  xlab('Insect abundance') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
                axis.line.x = element_line(colour = 'black'),
        axis.line.y = element_line(colour = 'black'),
        legend.position = 'none') +
  geom_boxplot(aes(group = Insect),outlier.shape = NA)+
   stat_smooth(method = 'lm',col = 'darkgrey') +
  annotate('text',x = 2.5,y = 1.6,label = 'B')

pdf('Figures/Figure 4.pdf',
    width = 4,
    height = 8,
    paper = 'a4')
multiplot(Fig4A,Fig4B)
dev.off()

```

dd$FAge <- factor(dd$Agemonths)
dd$Cohort <- factor(dd$LayYear)

lm1 <- lmer(RTL ~ Cohort*(Agemonths + LogAge + FAge) + (1|BirdID) + (1|CatchYear) + (1|PlateID),data=dd,REML = FALSE)

lm2 <- dredge(lm1,subset = !(LogAge & FAge) & !(LogAge & Agemonths ) & !(Agemonths & FAge))

lm2
