---
output:
  word_document:
    reference_docx: myref.docx
---
```{r setup, include = F}

rm(list=ls())

#Load knitr
library(knitr)

#Set some options
options(na.action='na.fail')
opts_knit$set(root.dir = '..')
opts_chunk$set(include=FALSE,
               message=FALSE,
               fig.show='hide')

```

```{r load and clean, include = F}

#Load and clean data
source('Scripts/SW juvenile telomeres IPC load.r')
source('Scripts/SW juvenile telomeres IPC functions.r')
source('Scripts/SW juvenile telomeres IPC clean.r')


```

**Figure Legends**

**Figure 1** Telomere length in relation to age in Seychelles warblers. **(A)** Mean  ($\pm$ s.e.) age for all birds. **(B)** Notched boxplot of telomere length at different age classes within the first year of life. Sample sizes for each group are provided in brackets.

**Figure 2** Factors affecting early-life telomere length in Seychelles warblers. **A** Model averaged estimates and 95% confidence intervals for explanatory terms used in a linear mixed model with telomere length (see main text for details; TQ = territory quality, TL = telomere length).

**Figure 3** Factors affecting early-life telomere shortening rates in Seychelles warblers, within seasons. Model averaged estimates and 95% confidence intervals for explanatory terms used in a linear mixed model with telomere length (cross-sectional data, **A**) and telomere loss (longitudinal data, **B**) as the response variable. Numbers in brackets are the relative importance of each term in the top model set (see main text for details; TQ = territory quality, TL = telomere length).

**Figure 4** Kaplan-Meier curves showing the relationship between survival and telomere length for juvenile Seychelles warblers. Telomere length is binned into groups here for visualisation purposes only (long and short = greater than or less than median telomere length, respectively).



```{r Figure 1}

temp <- dd
temp$Agemonths[temp$Agemonths>10] <- '12+'
temp$Agemonths <- factor(temp$Agemonths,levels = c('1','6','10','12+'))


Fig1A <- ggplot(temp,aes(x = Agemonths,y = RTL))+
  geom_jitter(col='grey') +
  ylab('RTL') + 
  xlab('Age (months)') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        legend.position = 'none')+
  geom_boxplot(outlier.colour=NA,alpha = 0.2)+
  annotate('text',x = 0.6,y = 2.1,label = 'A')

  
temp <- Loss
temp$Agemonths <- factor(temp$Agemonths)


Fig1B <- ggplot(temp,aes(x = Agemonths,y = TROC))+
  geom_jitter(col='grey') +
  ylab('Loss in RTL') + 
  xlab('Age (months)') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        legend.position = 'none')+
  geom_boxplot(outlier.colour=NA,alpha = 0.2)+
  annotate('text',x = 0.6,y = 2.1,label = 'B')


temp <- juv
temp$LayYear <- factor(temp$LayYear)


Fig1C <- ggplot(temp,
       aes(x = LayYear,
           y = RTL)) +
  ylab('RTL') + 
  xlab('') +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 60,size = 14,vjust=0.5), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = 'none') +
  geom_jitter(col = 'grey')+
  geom_boxplot(outlier.colour = NA,alpha = 0.2)+
  scale_x_discrete(limits = factor(1998:2014),drop=F)+
  annotate('text',x = 1,y = 2.1,label = 'C')


  

pdf('Figures/Figure 1.pdf',
    width = 6,
    height = 6,
    paper = 'a4r')
multiplot(Fig1A,Fig1B,Fig1C,layout=matrix(c(1,2,3,3),nrow = 2,byrow=T))
dev.off()


```




```{r Figure 2}

temp <- juv

#####################
#2A
#####################

#Run the model
lm2 <- lmer(RTL ~ Agemonths * (Tarsus + Helper + NonHelper + Sex + BodyMass  + TQ + Season)  + (1|LayYear) + (1|TerritoryID),
            data = temp,
            REML = FALSE)
lm2 <- standardize(lm2)
#Model averaging

lm3 <- dredge(lm2)
lm3 <- subset(lm3,delta <=6)
lmavg <- model.avg(lm3,fit=T)
myimp <- importance(lmavg) #Relative importance of each explanatory variable
  

#Put it all into a nice table
table2 <- imptable(lmavg,myimp)
table2 <- signif(table2,2)


#Sort out row/col names
nams <- rownames(table2)
nams[nams == 'z.NonHelper'] <- 'Non helpers'
nams[nams == 'c.Sex'] <- 'Sex'
nams[nams == 'z.TQ'] <- 'TQ'
nams[nams == 'c.Helper'] <- 'Helpers'
nams[nams == 'z.BodyMass'] <- 'Body mass'
nams[nams == 'z.Agemonths'] <- 'Age'
nams[nams == 'z.Tarsus'] <- 'Tarsus'
nams[nams == 'c.Season'] <- 'Season'
nams[nams == 'c.Season:z.Agemonths'] <- 'Age x season'
nams[nams == 'z.Agemonths:z.NonHelper'] <- 'Age x non helpers'
nams[nams == 'c.Sex:z.Agemonths'] <- 'Age x sex'
nams[nams == 'z.Agemonths:z.TQ'] <- 'Age x TQ'
nams[nams == 'c.Helper:z.Agemonths'] <- 'Age x helpers'
nams[nams == 'z.Agemonths:z.BodyMass'] <- 'Age x mass'
nams[nams == 'z.Agemonths:z.Tarsus'] <- 'Age x tarsus'


rownames(table2) <- nams
colnames(table2) <- c('Estimate','SE','2.5%','97.5%','RI')


table2 <- data.frame(table2,myx=row.names(table2))
table2$myx <- factor(table2$myx,levels = table2$myx[order(table2$Estimate,decreasing = T)])

Fig2A <- forestplot(table2)+
  annotate('text',x = 1,y = 0.25,label = 'A')



temp <- juv

temp[,'Helpers'] <- ifelse(temp$Helper>0,'Present', 'Absent')
temp[,'Non helpers'] <- ifelse(temp$NonHelper>0,'Present', 'Absent')
temp[,'Age (months)'] <- factor(temp$Agemonths) 

Fig2B <- ggplot(temp,
       aes(x = factor(Agemonths),
           y = RTL,
           fill=Season)) +
  ylab('RTL') + 
  xlab('Age (months)') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        legend.position = 'top') +
  geom_jitter(aes(colour = Season),position=position_jitterdodge(dodge.width = 0.8))+
  geom_boxplot(outlier.colour = NA,notch=F,alpha=0.2)+
  scale_colour_manual(values = c('grey','darkorange'))+
  scale_fill_manual(values = c('grey','darkorange'))+
  annotate('text',x = 0.55,y = 2.1,label = 'B')


  
Fig2C <- ggplot(temp,
       aes(x = Tarsus,
           y = RTL,
           colour=`Age (months)`,
           fill = `Age (months)`,
           shape = `Age (months)`)) +
  ylab('RTL') + 
  xlab('Tarsus length (mm)') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        legend.position = 'top') +
  geom_point(alpha = 0.2)+
  stat_smooth(method = 'lm')+
  scale_colour_manual(values = c(grey(0.2),'darkorange','darkgreen'))+
  scale_fill_manual(values = c('darkgrey','darkorange','darkgreen'))+
  annotate('text',x = 17,y = 2.1,label = 'C')



pdf('Figures/Figure 2.pdf',
    width = 8,
    height = 9,
    paper = 'a4r')
multiplot(Fig2A,Fig2B,Fig2C,layout = matrix(c(1,1,2,3),nrow = 2,byrow = T))
dev.off()




```
















```{r Figure 3}

temp <- Loss

#####################
#3A
#####################

#Run the model
lm2 <- lmer(TROC ~ Agemonths * (Tarsus + Helper + NonHelper + Sex + BodyMass  + TQ + Season) + (1|LayYear),
            data = temp,
            REML = FALSE)
lm2 <- standardize(lm2)
#Model averaging

lm3 <- dredge(lm2)
lm3 <- subset(lm3,delta <=6)
lmavg <- model.avg(lm3,fit=T)
myimp <- importance(lmavg) #Relative importance of each explanatory variable


#Put it all into a nice table
table2 <- imptable(lmavg,myimp)
table2 <- signif(table2,2)


#Sort out row/col names
nams <- rownames(table2)
nams[nams == 'z.NonHelper'] <- 'Non helpers'
nams[nams == 'c.Sex'] <- 'Sex'
nams[nams == 'z.TQ'] <- 'TQ'
nams[nams == 'c.Helper'] <- 'Helpers'
nams[nams == 'z.BodyMass'] <- 'Body mass'
nams[nams == 'z.Agemonths'] <- 'Age'
nams[nams == 'z.Tarsus'] <- 'Tarsus'
nams[nams == 'c.Season'] <- 'Season'
nams[nams == 'c.Season:z.Agemonths'] <- 'Age x season'
nams[nams == 'z.Agemonths:z.NonHelper'] <- 'Age x non helpers'
nams[nams == 'c.Sex:z.Agemonths'] <- 'Age x sex'
nams[nams == 'z.Agemonths:z.TQ'] <- 'Age x TQ'
nams[nams == 'c.Helper:z.Agemonths'] <- 'Age x helpers'
nams[nams == 'z.Agemonths:z.BodyMass'] <- 'Age x mass'
nams[nams == 'z.Agemonths:z.Tarsus'] <- 'Age x tarsus'


rownames(table2) <- nams
colnames(table2) <- c('Estimate','SE','2.5%','97.5%','RI')


table2 <- data.frame(table2,myx=row.names(table2))
table2$myx <- factor(table2$myx,levels = table2$myx[order(table2$Estimate,decreasing = T)])

Fig3A <- forestplot(table2)+
  annotate('text',x = 1,y = 0.45,label = 'A')


temp <- Loss

temp[,'Helpers'] <- ifelse(temp$Helper>0,'Present', 'Absent')
temp[,'Non helpers'] <- ifelse(temp$NonHelper>0,'Present', 'Absent')
temp[,'Age (months)'] <- factor(temp$Agemonths) 

Fig3B <- ggplot(temp,
       aes(x = factor(Agemonths),
           y = TROC,
           fill=Season)) +
  ylab('Loss in RTL') + 
  xlab('Age (months)') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        legend.position = 'top') +
  geom_jitter(aes(colour = Season),position=position_jitterdodge(dodge.width = 0.8))+
  geom_boxplot(outlier.colour = NA,notch=F,alpha=0.2)+
  scale_colour_manual(values = c('grey','darkorange'))+
  scale_fill_manual(values = c('grey','darkorange'))+
  annotate('text',x = 0.55,y = 2.1,label = 'B')


  
Fig3C <- ggplot(temp,
       aes(x = Tarsus,
           y = TROC,
           col=`Age (months)`)) +
  ylab('Loss in RTL') + 
  xlab('Tarsus length (mm)') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 12), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        legend.position = 'top') +
  geom_point(alpha = 0.2)+
  stat_smooth(method = 'lm')+
    scale_colour_manual(values = c(grey(0.2),'darkorange','darkgreen'))+
  scale_fill_manual(values = c('darkgrey','darkorange','darkgreen'))+
  annotate('text',x = 20,y = 2.1,label = 'C')


pdf('Figures/Figure 3.pdf',
    width = 8,
    height = 9,
    paper = 'a4r')
multiplot(Fig3A,Fig3B,Fig3C,layout = matrix(c(1,1,2,3),nrow = 2,byrow = T))
dev.off()

```