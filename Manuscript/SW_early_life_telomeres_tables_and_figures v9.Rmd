---
output:
  word_document:
    reference_docx: myref.docx
---
```{r setup, include = F}

rm(list=ls())

#Load knitr
library(knitr)

#Set some options
options(na.action='na.fail')
opts_knit$set(root.dir = '..')
opts_chunk$set(echo=FALSE,
               warning=FALSE,
               message=FALSE,
               fig.path='../Figures/',
               fig.width= 4,
               fig.height= 8,
               fig.show='asis',
               dev=c('png','pdf'))

```

```{r load and clean, include = F}

#Load and clean data
source('Scripts/SW juvenile telomeres IPC load.r')
source('Scripts/SW juvenile telomeres IPC functions.r')
source('Scripts/SW juvenile telomeres IPC clean.r')


```

**Figure Legends**

**Figure 1** Telomere length (mean $\pm$ s.e.) and age in Seychelles warblers, based on cross-sectional **(A)** and longitudinal **(B)** data. In **B**, telomere loss is a standardised and corrected rate (see methods for details) based on the difference in telomere length from the sample taken from birds in their first year of life, and the first available sample as an adult. Values above zero indicate telomere shortening in early life.

**Figure 2** Temporal variation in early-life telomere dynamics in the Seychelles warbler based on cross-sectional **(A)** and longitudinal **(B)** data (see Fig. 1 and main text for details). Points and error bars represent mean and standard error telomere length for all birds born in each main (black) or minor (grey) breeding season, in relation to island-wide food availability. Lines and shaded areas represent fitted values and 95% confidence limits from a linear regression.

**Figure 3** Factors affecting early-life telomere length in Seychelles warblers at the individual level, within seasons. **A** Model averaged estimates and 95% confidence intervals for alxplanatory terms used in a linear model with telomere length as the response variable. Numbers in brackets are the relative importance of each term in the top model set (see main text for details; TQ = territory quality). **B** Presence/absence of helpers and **c** tarsus length in relation to raw telomere length in nestlings (black, solid lines) and fledglings (grey, dashed lines). Points and error bars in **B** are mean $\pm$ s.e., and the line and shaded areas from **C** represent fitted values and 95% confidence limits from a linear regression.

**Figure 4** Temporal, cohort-level variation in early-life telomere dynamics and lifespan in the Seychelles warbler, based on cross-sectional **(A)** and longitudinal **(B)** data (see Fig. 1 and main text for details). Points and error bars represent means and $\pm$ s.e., respectively, of all birds born in each main (black) or minor (grey) breeding season. Lines and shaded areas represent fitted values and 95% confidence limits from a linear regression.

**Figure 5** Kaplan-Meier curves showing the relationship between telomere length and survival for individual Seychelles warblers measured as chicks (**A**), and fledglings  (**B**). Telomere length is binned into groups here for visualisation purposes only (long and short = greater than or less than median telomere length, repectively).








PAGEBREAK

**Figure 1**

```{r Figure 1,fig.width=5,fig.height=9}
######################
#1A
######################

ddFig1A <- ddply(dd,
                 .(Fledged),
                 summarize,
                 TLKBmean = mean(TLKB),
                 TLKBse = se(TLKB))



Fig1A <- ggplot(ddFig1A,
       aes(x = Fledged,
           y = TLKBmean)) +
  ylab('Telomere length (kb)') + 
  xlab('') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = c(0.1,0.9),
        legend.title = element_blank(),
        legend.text = element_text(size = 15)) +
  geom_pointrange(aes(ymin=TLKBmean-TLKBse,ymax=TLKBmean+TLKBse)) +
  annotate('text',label = 'A',x=0.6,y=6.2)





######################
#1B
######################

ddFig1B <- ddply(Loss,
                 .(Fledged),
                 summarize,
                 TROCmean = mean(TROC),
                 TROCse = se(TROC))



Fig1B <- ggplot(ddFig1B,
       aes(x = Fledged,
           y = TROCmean)) +
  ylab('Corrected telomere loss') + 
  xlab('') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = c(0.1,0.9),
        legend.title = element_blank(),
        legend.text = element_text(size = 15)) +
  geom_pointrange(aes(ymin=TROCmean-TROCse,ymax=TROCmean+TROCse)) +
  annotate('text',label = 'B',x=0.6,y=0.0018)

multiplot(Fig1A,Fig1B)

```











PAGEBREAK

**Figure 2**



```{r Figure 2,fig.width=5,fig.height=9}

####################

Fig2A <- ggplot(juvseason,
       aes(x = Insect,
           y = TLKBmean,
           col = Season)) +
  ylab('Telomere length') + 
  xlab('Food availability') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = 'none') +
  geom_pointrange(aes(ymin=TLKBmean-TLKBse,ymax=TLKBmean+TLKBse)) +
  stat_smooth(method = 'lm',se = T,col = 'black') +
  scale_color_manual(values = c('black',grey(0.4))) +
  annotate('text',label = 'A',x=-1.5,y=8)

################################


temp <- loss.season[complete.cases(loss.season),]

####################################
Fig2B <- ggplot(temp,
       aes(x = Insect,
           y = TROCmean,
           col = Season)) +
  geom_pointrange(aes(min=TROCmean-TROCse,ymax=TROCmean+TROCse)) +
  ylab('Corrected telomere loss') + 
  xlab('Food availability') + 
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = 'none') +
  stat_smooth(method = 'lm',se = T,  col = 'black') +
  scale_color_manual(values = c('black',grey(0.4))) +
  annotate('text',label = 'B',x=-1.5,y=0.0075)

multiplot(Fig2A,Fig2B)

```
















PAGEBREAK

**Figure 3**

```{r Figure 3,fig.width=9,fig.height=9}


######################
#3A
######################

#Run the model
lm2 <- lm(cenTL ~ Fledged*(cenHelper + cenNonHelper + Sex + cenTarsus  + cenTQ),
            data = juvall)

#Model averaging

lm3 <- dredge(lm2)
lmavg <- model.avg(lm3,subset = delta <=6)
myimp <- importance(lmavg) #Relative importance of each explanatory variable
  

#Put it all into a nice table
table2 <- imptable(lmavg,myimp)
table2 <- signif(table2,2)


#Sort out row/col names
nams <- rownames(table2)
nams[nams == 'cenTarsus'] <- 'Tarsus'
nams[nams == 'cenNonHelper'] <- 'Non helpers'
nams[nams == 'SexMales'] <- 'Sex'
nams[nams == 'cenTQ'] <- 'TQ'
nams[nams == 'cenHelper'] <- 'Helpers'
nams[nams == 'cenHelper:FledgedFledglings'] <- 'Ageclass x Helpers'
nams[nams == 'cenNonHelper:FledgedFledglings'] <- 'Ageclass x Non helpers'
nams[nams == 'cenTarsus:FledgedFledglings'] <- 'Ageclass x Tarsus'
nams[nams == 'cenTQ:FledgedFledglings'] <- 'Ageclass x TQ'
nams[nams == 'FledgedFledglings:SexMales'] <- 'Ageclass x Sex'
nams[nams == 'FledgedFledglings'] <- 'Ageclass'

rownames(table2) <- nams
colnames(table2) <- c('Estimate','SE','2.5%','97.5%','RI')


table2 <- data.frame(table2,myx=row.names(table2))

Fig3A <- forestplot(table2) +
  ylim(c(-1,1)) +
  annotate('text',label = 'A',x=0.6,y=1)



######################
#3B
######################

temp <- juv
temp$HelperF <- ifelse(juv$Helper>0,'Helpers present','Helpers absent')

ddFig3B <- ddply(temp,
                 .(HelperF,Fledged),
                 summarize,
                 TLKBmean = mean(TLKB),
                 TLKBse = se(TLKB))



Fig3B <- ggplot(ddFig3B,
       aes(x = HelperF,
           y = TLKBmean,
           col = Fledged,
           lty = Fledged)) +
  ylab('Telomere length (kb)') + 
  xlab('') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = 'none',
        legend.title = element_blank(),
        legend.text = element_text(size = 15)) +
  geom_pointrange(aes(ymin=TLKBmean-TLKBse,ymax=TLKBmean+TLKBse),
                  position = position_dodge(width = 0.2)) +
  scale_color_manual(values = c('black',grey(0.4))) +
  annotate('text',label = 'B',x=0.5,y=8)



######################
#3C
######################

Fig3C <- ggplot(juv,
                aes(x = Tarsus,
                    y = TLKB,
                    col=Fledged,
                    lty = Fledged)) +
  ylab('Telomere length (kb)') + 
  xlab('Tarsus length (mm)') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = 'none') +
  geom_point(size=3) +
  stat_smooth(method = 'lm',se = T) +
  scale_color_manual(values = c('black',grey(0.4))) +
  annotate('text',label = 'C',x=19,y=15)


multiplot(Fig3A,Fig3B,Fig3C,layout=matrix(c(1,1,2,3),2,2,byrow=TRUE))





```


PAGEBREAK



**Figure 4**

```{r Figure 4,fig.height=8,fig.width=4}


Fig4A <- ggplot(juvseason,
                aes(x = TLKBmean,
                    y = Lifespan,
                    col = Season)) +
  geom_pointrange(aes(ymin=Lifespan-Lifespanse,ymax=Lifespan+Lifespanse)) +
  geom_errorbarh(aes(xmin = TLKBmean-TLKBse,xmax = TLKBmean+TLKBse)) +
  theme_classic() +
  ylab('Remaining life') + 
  xlab('Telomere length (kb)') + 
  theme_classic() +
  theme(axis.text.x = element_text(size = 12), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        legend.position = 'none') +
  scale_color_manual(values = c('black',grey(0.4))) +
  annotate('text',x=2.5,y=10,label='A')




Fig4B <- ggplot(loss.season,
                aes(x = TROCmean,
                    y = Lifespan,
                    col = Season)) +
  geom_pointrange(aes(ymin=Lifespan-Lifespanse,ymax=Lifespan+Lifespanse)) +
  geom_errorbarh(aes(xmin = TROCmean-TROCse,xmax = TROCmean+TROCse)) +
  theme_classic() +
  ylab('Remaining life') + 
  xlab('Corrected telomere loss') + 
  theme_classic() +
  theme(axis.text.x = element_text(size = 11), 
        axis.text.y = element_text(size = 11), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        legend.position = 'none') +
  scale_color_manual(values = c('black',grey(0.4))) +
  stat_smooth(method = 'lm',se = T,col = 'black',fullrange = T) +
  annotate('text',x=-0.004,y=12.5,label='B')


multiplot(Fig4A,Fig4B)

```


PAGEBREAK



















**Figure 5**

```{r Figure 5,fig.height=8,fig.width=4}

s1 <- survfit(Surv(time = Lifespan+1, event = Died)~TLF, data = chicks)
Fig5A <- ggsurv(s1,plot.cens=F) + 
  theme_classic() +
  ylab('Proportion survived') + 
  xlab('Age (years)') + 
  xlim(c(0,15)) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = c(0.8,0.8),
        legend.text = element_text(size = 12),
        legend.title = element_blank()) +
  scale_colour_manual(name = 'TL',
                      values = c('black',grey(0.4))) +
  guides(linetype=F) +
  annotate('text',x=0.5,y=1.1,label='A')


###########################################
s2 <- survfit(Surv(time = Lifespan+1, event = Died)~TLF, data = FlSAall)
Fig5B <- ggsurv(s2,plot.cens=F) + 
  theme_classic() +
  ylab('Proportion survived') + 
  xlab('Age (years)') + 
  xlim(c(0,15)) +
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = 'none',
        legend.text = element_text(size = 12),
        legend.title = element_blank()) +
  scale_colour_manual(name = 'TL',
                      values = c('black',grey(0.4))) +
  guides(linetype=F) +
  annotate('text',x=0.5,y=1.1,label='B')

multiplot(Fig5A,Fig5B)


```

