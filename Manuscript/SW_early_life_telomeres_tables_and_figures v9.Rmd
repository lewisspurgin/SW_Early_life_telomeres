---
output:
  word_document:
    reference_docx: myref.docx
---
```{r setup, include = F}

rm(list=ls())

#Load knitr
library(knitr)

#Set some options
options(na.action='na.fail')
opts_knit$set(root.dir = '..')
opts_chunk$set(echo=FALSE,
               warning=FALSE,
               message=FALSE,
               fig.path='../Figures/',
               fig.width= 4,
               fig.height= 8,
               fig.show='asis',
               dev=c('png','pdf'))

```

```{r load and clean, include = F}

#Load and clean data
source('Scripts/SW juvenile telomeres IPC load.r')
source('Scripts/SW juvenile telomeres IPC functions.r')
source('Scripts/SW juvenile telomeres IPC clean.r')


```

**Figure Legends**

**Figure 1** Telomere length and age Seychelles warblers, based on cross-sectional **(A)** and longitudinal **(B)** data. Points and error bars represent mean and 95% confidence intervals, respectively. In **B**, telomere loss is a standardised and corrected rate (see methods for details) based on differences in telomere length between the sampling event of birds as a juvnile, and the first available sampling as an adult. Values above zero indicate telomere shortening in early life.

**Figure 2** Temporal variation in early-life telomere length in the Seychelles warbler based on cross-sectional **(A,B)** and longitudinal **(C,D)** data (see Figure 1 and main text for details). Points and error bars represent mean and standard error telomere length for each summer (blue) or winter (red) field season. In **A** and **C** points are ordered temporally, while in **B** and **D** telomere length/loss for each season is plotted against island-wide food availability. Lines and shaded areas represent fitted values and 95% confidence limits from a linear regression.

**Figure 3** Factors affecting telomere length in Seychelles warbler chicks. **A** Model averaged estimates and 95% confidence intervals for all explanatory terms used in a linear model with telomere length as the response variable. Numbers in brackets are the relative importance of each term in the top model set (see main text for details; Food av. = annual food availability, TQ = territory quality). **B** Presence/absence of helpers, **C** sex and **D** tarsus length in relation to raw telomere length. Points and error bars in **B and C** are mean $\pm$ standard error telomere lengths for each group, and the line and shaded areas from **D** represent fitted values and 95% confidence limits from a linear regression.

**Figure 4** Factors affecting telomere length in Seychelles warblers fledglings **(A)** and subadults **(B)**. Model averaged estimates and 95% confidence intervals for all explanatory terms used in a linear model with  telomere length as the response variable. Numbers in brackets are the relative importance of each term in the top model set (see main text for details; Food av. = annual food availability, TQ = territory quality).

**Figure 5** Kaplan-Meier curves showing the relationship between telomere length and survival in chick (**A**) and juvenile (**B**) Seychelles warblers. Telomere length is binned into groups here for visualisation purposes only (long and short = greater than or less than median telomere length, repectively).








PAGEBREAK

**Figure 1**

```{r Figure 1,fig.width=8,fig.height=9}
######################
#1A
######################

temp <- dd
levels(temp$Ageclass) <- c('Chicks',rep('Fledglings',3),'Sub-adults','Adults')

ddFig1A <- ddply(temp,
                 .(Ageclass),
                 summarize,
                 TLKBmean = mean(TLKB),
                 TLKBse = se(TLKB))



Fig1A <- ggplot(ddFig1A,
       aes(x = Ageclass,
           y = TLKBmean)) +
  ylab('Corrected telomere loss') + 
  xlab('') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = c(0.1,0.9),
        legend.title = element_blank(),
        legend.text = element_text(size = 15)) +
  geom_pointrange(aes(ymin=TLKBmean-TLKBse,ymax=TLKBmean+TLKBse)) +
  annotate('text',label = 'A',x=0.5,y=6.2)





######################
#1B
######################

temp <- Loss
levels(temp$Ageclass) <- c('Chicks','Fledglings','Sub-adults')

ddFig1B <- ddply(temp,
                 .(Ageclass),
                 summarize,
                 TROCmean = mean(TROC),
                 TROCse = se(TROC))



Fig1B <- ggplot(ddFig1B,
       aes(x = Ageclass,
           y = TROCmean)) +
  ylab('Telomere length (kb)') + 
  xlab('') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = c(0.1,0.9),
        legend.title = element_blank(),
        legend.text = element_text(size = 15)) +
  geom_pointrange(aes(ymin=TROCmean-TROCse,ymax=TROCmean+TROCse)) +
  annotate('text',label = 'B',x=0.5,y=0.0018)

multiplot(Fig1A,Fig1B)

```











PAGEBREAK

**Figure 2**



```{r Figure 2,fig.width=9,fig.height=9}

ddFig2A <- ddply(juv,
                 .(CatchYear,Season),
                 summarize,
                 TLKBmean = mean(TLKB),
                 TLKBse = se(TLKB))
ddFig2A <- ddFig2A[complete.cases(ddFig2A),]
ddFig2A <- subset(ddFig2A,TLKBse < 4)

Fig2A <- ggplot(ddFig2A,
       aes(x = CatchYear,
           y = TLKBmean,
           col = Season)) +
  ylab('Telomere length') + 
  xlab('Year') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = 'none') +
  geom_pointrange(aes(ymin=TLKBmean-TLKBse,ymax=TLKBmean+TLKBse),
                  position = position_dodge(width = 1)) +
  scale_color_manual(values = wes_palette("Royal1")) +
  annotate('text',label = 'A',x=1995,y=10)



####################

temp <- juv
temp$Insect <- factor(temp$Insect)

ddFig2B <- ddply(temp,
                 .(Insect,Season),
                 summarize,
                 TLKBmean = mean(TLKB),
                 TLKBse = se(TLKB))
ddFig2B$Insect <- as.numeric(paste(ddFig2B$Insect))
ddFig2B <- ddFig2B[complete.cases(ddFig2B),]

Fig2B <- ggplot(ddFig2B,
       aes(x = Insect,
           y = TLKBmean,
           col = Season)) +
  ylab('Telomere length') + 
  xlab('Food availability') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = 'none') +
  geom_pointrange(aes(ymin=TLKBmean-TLKBse,ymax=TLKBmean+TLKBse)) +
  stat_smooth(method = 'lm',se=T,col = 'darkgrey') +
  scale_color_manual(values = wes_palette("Royal1")) +
  annotate('text',label = 'B',x=-1.5,y=8)

################################



ddFig2C <- ddply(Loss,
                 .(CatchYear,Season),
                 summarize,
                 TROCmean = mean(TROC),
                 TROCse = se(TROC))
ddFig2C <- ddFig2C[complete.cases(ddFig2C),]
ddFig2C <- subset(ddFig2C,TROCse < 4)

Fig2C <- ggplot(ddFig2C,
       aes(x = CatchYear,
           y = TROCmean,
           col = Season)) +
  ylab('Corrected telomere loss') + 
  xlab('Year') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = 'none') +
  geom_pointrange(aes(ymin=TROCmean-TROCse,ymax=TROCmean+TROCse),
                  position = position_dodge(width = 1)) +
  scale_color_manual(values = wes_palette("Royal1")) +
  annotate('text',label = 'C',x=1995,y=0.009)



####################################
temp <- Loss
temp$Insect <- factor(temp$Insect)

ddFig2D <- ddply(temp,
                 .(Insect,Season),
                 summarise,
                 TROCmean = mean(TROC),
                 TROCse = se(TROC))
ddFig2D$Insect <- as.numeric(paste(ddFig2D$Insect))
ddFig2D <- ddFig2D[complete.cases(ddFig2D),]

Fig2D <- ggplot(ddFig2D,
       aes(x = Insect,
           y = TROCmean,
           col = Season)) +
  geom_pointrange(aes(min=TROCmean-TROCse,ymax=TROCmean+TROCse)) +
  ylab('Corrected telomere loss') + 
  xlab('Food availability') + 
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = 'none') +
  stat_smooth(method = 'lm', se=T, col = 'darkgrey') +
  scale_color_manual(values = wes_palette("Royal1")) +
  annotate('text',label = 'D',x=-1.5,y=0.0075)

multiplot(Fig2A,Fig2B,Fig2C,Fig2D,layout=matrix(1:4,2,2))

```
















PAGEBREAK

**Figure 3**

```{r Figure 3,fig.width=8,fig.height=9}


######################
#3A
######################

#Run the model
lm2 <- lm(cenTL ~ cenHelper + cenNonHelper + Sex + cenTarsus  + cenTQ,
            data = chickall)

#Model averaging

lm3 <- dredge(lm2)
lmavg <- model.avg(lm3,subset = delta <=6)
myimp <- importance(lmavg) #Relative importance of each explanatory variable
  

#Put it all into a nice table
table2 <- imptable(lmavg,myimp)
table2 <- signif(table2,2)


#Sort out row/col names
nams <- rownames(table2)
nams[nams == 'cenTarsus'] <- 'Tarsus'
nams[nams == 'cenNonHelper'] <- 'Non helpers'
nams[nams == 'SexMales'] <- 'Sex'
nams[nams == 'cenTQ'] <- 'TQ'
nams[nams == 'cenHelper'] <- 'Helpers'

rownames(table2) <- nams
colnames(table2) <- c('Estimate','SE','2.5%','97.5%','RI')

table2 <- data.frame(table2,myx=row.names(table2))

Fig3A <- forestplot(table2) +
  annotate('text',label = 'A',x=0.6,y=1.2)



######################
#3B
######################

temp <- chicks

ddFig3B <- ddply(temp,
                 .(Sex),
                 summarize,
                 TLKBmean = mean(TLKB),
                 TLKBse = se(TLKB))



Fig3B <- ggplot(ddFig3B,
       aes(x = Sex,
           y = TLKBmean)) +
  ylab('Telomere length (kb)') + 
  xlab('') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = c(0.1,0.9),
        legend.title = element_blank(),
        legend.text = element_text(size = 15)) +
  geom_pointrange(aes(ymin=TLKBmean-TLKBse,ymax=TLKBmean+TLKBse)) +
  annotate('text',label = 'B',x=0.5,y=7)



######################
#3C
######################

temp <- chicks
temp$HelperF <- ifelse(chicks$Helper>0,'Helpers present','Helpers absent')

ddFig3C <- ddply(temp,
                 .(HelperF),
                 summarize,
                 TLKBmean = mean(TLKB),
                 TLKBse = se(TLKB))



Fig3C <- ggplot(ddFig3C,
       aes(x = HelperF,
           y = TLKBmean)) +
  ylab('Telomere length (kb)') + 
  xlab('') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = c(0.1,0.9),
        legend.title = element_blank(),
        legend.text = element_text(size = 15)) +
  geom_pointrange(aes(ymin=TLKBmean-TLKBse,ymax=TLKBmean+TLKBse)) +
  annotate('text',label = 'C',x=0.5,y=8)



######################
#3D
######################

Fig3D <- ggplot(chicks,
                aes(x = Tarsus,
                    y = TLKB)) +
  ylab('Telomere length (kb)') + 
  xlab('Tarsus length (mm)') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16)) +
  geom_point(size=3) +
  stat_smooth(method = 'lm',col = 'black') +
  scale_color_manual(values = wes_palette("Royal1")) +
  annotate('text',label = 'D',x=19,y=15)


multiplot(Fig3A,Fig3B,Fig3C,Fig3D,layout=matrix(c(1:4), nrow=2, byrow=FALSE))


```


PAGEBREAK






















**Figure 4**

```{r Figure 4,fig.width=5,fig.height=9}

######################
#3A
######################
Fl <- subset(FlSAall,Ageclass == 'FL')

#Run the model
lm2 <- lm(cenTL ~ cenHelper + cenNonHelper + Sex + cenTarsus  + cenTQ,
            data = Fl)

#Model averaging
lm3 <- dredge(lm2)
lmavg <- model.avg(lm3,subset = delta <=6)
myimp <- importance(lmavg) #Relative importance of each explanatory variable
  

#Put it all into a nice table
table2 <- imptable(lmavg,myimp)
table2 <- signif(table2,2)


nams <- rownames(table2)
nams[nams == 'cenTarsus'] <- 'Tarsus'
nams[nams == 'cenNonHelper'] <- 'Non helpers'
nams[nams == 'SexMales'] <- 'Sex'
nams[nams == 'cenTQ'] <- 'TQ'
nams[nams == 'cenHelper'] <- 'Helpers'

rownames(table2) <- nams
colnames(table2) <- c('Estimate','SE','2.5%','97.5%','RI')

table2 <- data.frame(table2,myx=row.names(table2))

Fig4A <- forestplot(table2) +
  annotate('text',label = 'A',x=0.6,y=0.8)


######################
#4B
######################
SA <- subset(FlSAall,Ageclass == 'SA')

#Run the model
lm2 <- lm(cenTL ~ cenHelper + cenNonHelper + Sex + cenTarsus  + cenTQ,
            data = SA)


#Model averaging
lm4 <- dredge(lm2)
lmavg <- model.avg(lm4,subset = delta <=6)
myimp <- importance(lmavg) #Relative importance of each explanatory variable
  

#Put it all into a nice table
table2 <- imptable(lmavg,myimp)
table2 <- signif(table2,2)


nams <- rownames(table2)
nams[nams == 'cenTarsus'] <- 'Tarsus'
nams[nams == 'cenNonHelper'] <- 'Non helpers'
nams[nams == 'SexMales'] <- 'Sex'
nams[nams == 'cenTQ'] <- 'TQ'
nams[nams == 'cenHelper'] <- 'Helpers'

rownames(table2) <- nams
colnames(table2) <- c('Estimate','SE','2.5%','97.5%','RI')

table2 <- data.frame(table2,myx=row.names(table2))

Fig4B <- forestplot(table2) +
  annotate('text',label = 'B',x=0.6,y=0.6)

multiplot(Fig4A,Fig4B)


```

PAGEBREAK



























**Figure 5**

```{r Figure 5,fig.height=8,fig.width=5}

s1 <- survfit(Surv(time = Lifespan+1, event = Died)~TLF, data = chicks)
Fig5A <- ggsurv(s1,plot.cens=F) + 
  theme_classic() +
  ylab('Proportion survived') + 
  xlab('Age (years)') + 
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = c(0.8,0.8),
        legend.text = element_text(size = 12),
        legend.title = element_blank()) +
  scale_colour_manual(name = 'TL',
                      values = c('darkred','red')) +
  guides(linetype=F) +
  annotate('text',x=0.5,y=1.1,label='A')


###########################################


s2 <- survfit(Surv(time = Lifespan+1, event = Died)~TLF, data = FlSAall)
Fig5B <- ggsurv(s2,plot.cens=F) + 
  theme_classic() +
  ylab('Proportion survived') + 
  xlab('Age (years)') + 
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = c(0.8,0.8),
        legend.text = element_text(size = 12),
        legend.title = element_blank()) +
  scale_colour_manual(name = 'TL',
                      values = c('darkred','red')) +
  guides(linetype=F) +
  annotate('text',x=0.5,y=1.1,label='B')

multiplot(Fig5A,Fig5B)


```

