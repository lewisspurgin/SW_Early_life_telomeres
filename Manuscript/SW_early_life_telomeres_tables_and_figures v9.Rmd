---
output:
  word_document:
    reference_docx: myref.docx
---
```{r setup, include = F}

rm(list=ls())

#Load knitr
library(knitr)

#Set some options
options(na.action='na.fail')
opts_knit$set(root.dir = '..')
opts_chunk$set(echo=FALSE,
               warning=FALSE,
               message=FALSE,
               fig.path='../Figures/',
               fig.width= 4,
               fig.height= 8,
               fig.show='asis',
               dev=c('png','pdf'))

```

```{r load and clean, include = F}

#Load and clean data
source('Scripts/SW juvenile telomeres IPC load.r')
source('Scripts/SW juvenile telomeres IPC functions.r')
source('Scripts/SW juvenile telomeres IPC clean.r')


```

**Figure Legends**

**Figure 1** Telomere length (mean $\pm$ s.e.) and age Seychelles warblers, based on cross-sectional **(A)** and longitudinal **(B)** data. In **B**, telomere loss is a standardised and corrected rate (see methods for details) based on the difference in telomere length from the sample taken from birds in their first year of life, and the first available sampling as an adult. Values above zero indicate telomere shortening in early life.

**Figure 2** Temporal variation in early-life telomere dynamics in the Seychelles warbler based on cross-sectional **(A,B)** and longitudinal **(C,D)** data (see Fig. 1 and main text for details). Points and error bars represent mean and standard error telomere length for all birds born in each summer (blue) or winter (red) breeding season. In **A** and **C** points are ordered temporally, while in **B** and **D** telomere length/loss for each season is plotted against island-wide food availability. Lines and shaded areas represent fitted values and 95% confidence limits from a linear regression.

**Figure 3** Factors affecting telomere length in Seychelles warbler chicks. **A** Model averaged estimates and 95% confidence intervals for all explanatory terms used in a linear model with telomere length as the response variable. Numbers in brackets are the relative importance of each term in the top model set (see main text for details; TQ = territory quality). **B** Presence/absence of helpers and **c** tarsus length in relation to raw telomere length. Points and error bars in **B** are mean $\pm$ s.e., and the line and shaded areas from **C** represent fitted values and 95% confidence limits from a linear regression.

**Figure 4** Factors affecting telomere length in Seychelles warblers fledglings **(A)** and subadults **(B)**. Points and error bars represent model averaged estimates and 95% confidence intervals for all explanatory terms used in a linear model with  telomere length as the response variable. Numbers in brackets are the relative importance of each term in the top model set (see main text for details; TQ = territory quality).

**Figure 5** Temporal variation in early-life telomere dynamics and lifespan in the Seychelles warbler, based on cross-sectional **(A)** and longitudinal **(B)** data (see Fig. 1 and main text for details). Points and error bars represent means and $\pm$ s.e., respectively. 

**Figure 6** Kaplan-Meier curves showing the relationship between telomere length and survival in chick (**A**), fledgling  (**B**) and sub-adult (**C**) Seychelles warblers. Telomere length is binned into groups here for visualisation purposes only (long and short = greater than or less than median telomere length, repectively).








PAGEBREAK

**Figure 1**

```{r Figure 1,fig.width=6,fig.height=9}
######################
#1A
######################

temp <- dd
levels(temp$Ageclass) <- c('Chicks',rep('Fledglings',3),'Sub-adults','Adults')

ddFig1A <- ddply(temp,
                 .(Ageclass),
                 summarize,
                 TLKBmean = mean(TLKB),
                 TLKBse = se(TLKB))



Fig1A <- ggplot(ddFig1A,
       aes(x = Ageclass,
           y = TLKBmean)) +
  ylab('Telomere length (kb)') + 
  xlab('') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = c(0.1,0.9),
        legend.title = element_blank(),
        legend.text = element_text(size = 15)) +
  geom_pointrange(aes(ymin=TLKBmean-TLKBse,ymax=TLKBmean+TLKBse)) +
  annotate('text',label = 'A',x=0.5,y=6.2)





######################
#1B
######################

temp <- Loss
levels(temp$Ageclass) <- c('Chicks','Fledglings','Sub-adults')

ddFig1B <- ddply(temp,
                 .(Ageclass),
                 summarize,
                 TROCmean = mean(TROC),
                 TROCse = se(TROC))



Fig1B <- ggplot(ddFig1B,
       aes(x = Ageclass,
           y = TROCmean)) +
  ylab('Corrected telomere loss') + 
  xlab('') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = c(0.1,0.9),
        legend.title = element_blank(),
        legend.text = element_text(size = 15)) +
  geom_pointrange(aes(ymin=TROCmean-TROCse,ymax=TROCmean+TROCse)) +
  annotate('text',label = 'B',x=0.5,y=0.0018)

multiplot(Fig1A,Fig1B)

```











PAGEBREAK

**Figure 2**



```{r Figure 2,fig.width=9,fig.height=9}

Fig2A <- ggplot(juvseason,
       aes(x = CatchYear,
           y = TLKBmean,
           col = Season)) +
  ylab('Telomere length') + 
  xlab('Year') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = 'none') +
  geom_pointrange(aes(ymin=TLKBmean-TLKBse,ymax=TLKBmean+TLKBse),
                  position = position_dodge(width = 0.2)) +
  scale_color_manual(values = wes_palette("Royal1")) +
  annotate('text',label = 'A',x=1995,y=10)



####################

Fig2B <- ggplot(juvseason,
       aes(x = Insect,
           y = TLKBmean,
           col = Season)) +
  ylab('Telomere length') + 
  xlab('Food availability') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = 'none') +
  geom_pointrange(aes(ymin=TLKBmean-TLKBse,ymax=TLKBmean+TLKBse)) +
  stat_smooth(method = 'lm',se=T,col = 'darkgrey') +
  scale_color_manual(values = wes_palette("Royal1")) +
  annotate('text',label = 'B',x=-1.5,y=8)

################################


temp <- loss.season[complete.cases(loss.season),]

Fig2C <- ggplot(temp,
       aes(x = CatchYear,
           y = TROCmean,
           col = Season)) +
  ylab('Corrected telomere loss') + 
  xlab('Year') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = 'none') +
  geom_pointrange(aes(ymin=TROCmean-TROCse,ymax=TROCmean+TROCse),
                  position = position_dodge(width = 0.2)) +
  scale_color_manual(values = wes_palette("Royal1")) +
  annotate('text',label = 'C',x=1995,y=0.005)



####################################
Fig2D <- ggplot(temp,
       aes(x = Insect,
           y = TROCmean,
           col = Season)) +
  geom_pointrange(aes(min=TROCmean-TROCse,ymax=TROCmean+TROCse)) +
  ylab('Corrected telomere loss') + 
  xlab('Food availability') + 
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = 'none') +
  stat_smooth(method = 'lm', se=T, col = 'darkgrey') +
  scale_color_manual(values = wes_palette("Royal1")) +
  annotate('text',label = 'D',x=-1.5,y=0.0075)

multiplot(Fig2A,Fig2B,Fig2C,Fig2D,layout=matrix(1:4,2,2))

```
















PAGEBREAK

**Figure 3**

```{r Figure 3,fig.width=9,fig.height=9}


######################
#3A
######################

#Run the model
lm2 <- lm(cenTL ~ cenHelper + cenNonHelper + Sex + cenTarsus  + cenTQ,
            data = chickall)

#Model averaging

lm3 <- dredge(lm2)
lmavg <- model.avg(lm3,subset = delta <=6)
myimp <- importance(lmavg) #Relative importance of each explanatory variable
  

#Put it all into a nice table
table2 <- imptable(lmavg,myimp)
table2 <- signif(table2,2)


#Sort out row/col names
nams <- rownames(table2)
nams[nams == 'cenTarsus'] <- 'Tarsus'
nams[nams == 'cenNonHelper'] <- 'Non helpers'
nams[nams == 'SexMales'] <- 'Sex'
nams[nams == 'cenTQ'] <- 'TQ'
nams[nams == 'cenHelper'] <- 'Helpers'

rownames(table2) <- nams
colnames(table2) <- c('Estimate','SE','2.5%','97.5%','RI')

table2 <- data.frame(table2,myx=row.names(table2))

Fig3A <- forestplot(table2) +
  annotate('text',label = 'A',x=0.6,y=0.6)



######################
#3B
######################

temp <- chicks
temp$HelperF <- ifelse(chicks$Helper>0,'Helpers present','Helpers absent')

ddFig3B <- ddply(temp,
                 .(HelperF),
                 summarize,
                 TLKBmean = mean(TLKB),
                 TLKBse = se(TLKB))



Fig3B <- ggplot(ddFig3B,
       aes(x = HelperF,
           y = TLKBmean)) +
  ylab('Telomere length (kb)') + 
  xlab('') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = c(0.1,0.9),
        legend.title = element_blank(),
        legend.text = element_text(size = 15)) +
  geom_pointrange(aes(ymin=TLKBmean-TLKBse,ymax=TLKBmean+TLKBse)) +
  annotate('text',label = 'B',x=0.5,y=8)



######################
#3C
######################

Fig3C <- ggplot(chicks,
                aes(x = Tarsus,
                    y = TLKB)) +
  ylab('Telomere length (kb)') + 
  xlab('Tarsus length (mm)') +
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16)) +
  geom_point(size=3) +
  stat_smooth(method = 'lm',col = 'black') +
  scale_color_manual(values = wes_palette("Royal1")) +
  annotate('text',label = 'C',x=19,y=15)


multiplot(Fig3A,Fig3B,Fig3C,layout=matrix(c(1,1,2,3),2,2,byrow=TRUE))


```


PAGEBREAK






















**Figure 4**

```{r Figure 4,fig.width=5,fig.height=9}

######################
#3A
######################
Fl <- subset(FlSAall,Ageclass == 'FL')

#Run the model
lm2 <- lm(cenTL ~ cenHelper + cenNonHelper + Sex + cenTarsus  + cenTQ,
            data = Fl)

#Model averaging
lm3 <- dredge(lm2)
lmavg <- model.avg(lm3,subset = delta <=6)
myimp <- importance(lmavg) #Relative importance of each explanatory variable
  

#Put it all into a nice table
table2 <- imptable(lmavg,myimp)
table2 <- signif(table2,2)


nams <- rownames(table2)
nams[nams == 'cenTarsus'] <- 'Tarsus'
nams[nams == 'cenNonHelper'] <- 'Non helpers'
nams[nams == 'SexMales'] <- 'Sex'
nams[nams == 'cenTQ'] <- 'TQ'
nams[nams == 'cenHelper'] <- 'Helpers'

rownames(table2) <- nams
colnames(table2) <- c('Estimate','SE','2.5%','97.5%','RI')

table2 <- data.frame(table2,myx=row.names(table2))

Fig4A <- forestplot(table2) +
  annotate('text',label = 'A',x=0.6,y=0.8)


######################
#4B
######################
SA <- subset(FlSAall,Ageclass == 'SA')

#Run the model
lm2 <- lm(cenTL ~ cenHelper + cenNonHelper + Sex + cenTarsus  + cenTQ,
            data = SA)


#Model averaging
lm4 <- dredge(lm2)
lmavg <- model.avg(lm4,subset = delta <=6)
myimp <- importance(lmavg) #Relative importance of each explanatory variable
  

#Put it all into a nice table
table2 <- imptable(lmavg,myimp)
table2 <- signif(table2,2)


nams <- rownames(table2)
nams[nams == 'cenTarsus'] <- 'Tarsus'
nams[nams == 'cenNonHelper'] <- 'Non helpers'
nams[nams == 'SexMales'] <- 'Sex'
nams[nams == 'cenTQ'] <- 'TQ'
nams[nams == 'cenHelper'] <- 'Helpers'

rownames(table2) <- nams
colnames(table2) <- c('Estimate','SE','2.5%','97.5%','RI')

table2 <- data.frame(table2,myx=row.names(table2))

Fig4B <- forestplot(table2) +
  annotate('text',label = 'B',x=0.6,y=0.6)

multiplot(Fig4A,Fig4B)


```

PAGEBREAK








**Figure 5**

```{r Figure 5,fig.height=8,fig.width=4}


Fig5A <- ggplot(juvseason,
                aes(x = TLKBmean,
                    y = Lifespan,
                    col = Season)) +
  geom_pointrange(aes(ymin=Lifespan-Lifespanse,ymax=Lifespan+Lifespanse)) +
  geom_errorbarh(aes(xmin = TLKBmean-TLKBse,xmax = TLKBmean+TLKBse)) +
  theme_classic() +
  ylab('Remaining life') + 
  xlab('Telomere length (kb)') + 
  theme_classic() +
  theme(axis.text.x = element_text(size = 12), 
        axis.text.y = element_text(size = 12), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        legend.position = 'none') +
  scale_color_manual(values = wes_palette("Royal1")) +
  annotate('text',x=2.5,y=12.5,label='A')





Fig5B <- ggplot(loss.season,
                aes(x = TROCmean,
                    y = Lifespan,
                    col = Season)) +
  geom_pointrange(aes(ymin=Lifespan-Lifespanse,ymax=Lifespan+Lifespanse)) +
  geom_errorbarh(aes(xmin = TROCmean-TROCse,xmax = TROCmean+TROCse)) +
  theme_classic() +
  ylab('Remaining life') + 
  xlab('Corrected telomere loss') + 
  theme_classic() +
  theme(axis.text.x = element_text(size = 11), 
        axis.text.y = element_text(size = 11), 
        axis.title.y = element_text(size = 14,vjust=0.8),
        axis.title.x = element_text(size = 14),
        legend.position = 'none') +
  scale_color_manual(values = wes_palette("Royal1")) +
  stat_smooth(method = 'lm',col = 'darkgrey',fullrange = T) +
  annotate('text',x=-0.004,y=14,label='B')


multiplot(Fig5A,Fig5B)

```


PAGEBREAK



















**Figure 6**

```{r Figure 6,fig.height=9,fig.width=4}

s1 <- survfit(Surv(time = Lifespan+1, event = Died)~TLF, data = chicks)
Fig6A <- ggsurv(s1,plot.cens=F) + 
  theme_classic() +
  ylab('Proportion survived') + 
  xlab('Age (years)') + 
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = c(0.8,0.8),
        legend.text = element_text(size = 12),
        legend.title = element_blank()) +
  scale_colour_manual(name = 'TL',
                      values = c('darkred','red')) +
  guides(linetype=F) +
  annotate('text',x=0.5,y=1.1,label='A')


###########################################
s2 <- survfit(Surv(time = Lifespan+1, event = Died)~TLF, data = subset(FlSAall,Ageclass == 'FL'))
Fig6B <- ggsurv(s2,plot.cens=F) + 
  theme_classic() +
  ylab('Proportion survived') + 
  xlab('Age (years)') + 
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = 'none',
        legend.text = element_text(size = 12),
        legend.title = element_blank()) +
  scale_colour_manual(name = 'TL',
                      values = c('darkred','red')) +
  guides(linetype=F) +
  annotate('text',x=0.5,y=1.1,label='B')

###########################################

s2 <- survfit(Surv(time = Lifespan+1, event = Died)~TLF, data = subset(FlSAall,Ageclass == 'SA'))
Fig6C <- ggsurv(s2,plot.cens=F) + 
  theme_classic() +
  ylab('Proportion survived') + 
  xlab('Age (years)') + 
  theme_classic() +
  theme(axis.text.x = element_text(size = 14), 
        axis.text.y = element_text(size = 14), 
        axis.title.y = element_text(size = 16,vjust=0.8),
        axis.title.x = element_text(size = 16),
        legend.position = 'none',
        legend.text = element_text(size = 12),
        legend.title = element_blank()) +
  scale_colour_manual(name = 'TL',
                      values = c('darkred','red')) +
  guides(linetype=F) +
  annotate('text',x=0.5,y=1.1,label='C')

multiplot(Fig6A,Fig6B,Fig6C)


```

